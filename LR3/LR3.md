# **Лабораторная работа №3**
Цель работы: Поиск и устранение XSS уязвимостей.
## **Задание**
В папке lab3 находится nodejs уязвимое приложение. Необходимо развернуть его, найти источники XSS и исправить. Модифицированное приложение загрузить в свой репозиторий GitHub.

Для выполнения лабораторной потребуется проделать следующие шаги (если вы их проделали для лабораторной 2, то повторять не нужно):

\1. Установить PostgreSQL сервер любой версии 

\2. Создать БД lib

\3. Применить к ней скрипты из папки db (либо создать объекты и вставить данные в таблицы руками). Скрипты выполнять в порядке указанном в имени файла. 

3.1 Восстановить данные из файла data.sql 

\4. Установить nodejs версии 14. 

Данные пункты выполнялись в лабораторной работе №2.

\5. Перейти в папку lab3 и выполнить в ней команду npm install. 

\6. Запустить сайт через Visual Studio Code или через команду npm start.

Потребовалось установить модуль «cookie-parser» для последующей работы с файлами Cookie.

![](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.001.png)

*image*

7. Войти на сайт и увидеть список книг и авторов
7. На странице со списком книг найти 

8.1 Reflected XSS в поиске книг

***<img src=1 href=1 onerror=‘javascript:alert(1)’>***

![image](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.002.png)

*image*

Исправление уязвимости:

Для строки поиска книг можно воспользоваться prepared statement, как в ЛР2

![image](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.003.png)

*image*

![image](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.004.png)

*image*

8.2 Persisted (Stored) XSS при создании книги и отображении списка книг

***<html onclick=“alert(1)”>test</html>***

Теперь при любом клике на сайте будет выскакивать окно:

![image](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.005.png)

*image*

Команда в исходном коде:

![image](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.006.png)

*image*

Исправление уязвимости:

При добавлении книг самый простой способ – просто заменять символы < и >, например:

***let bname = req.body.bookname.replace(‘<’, ‘(’).replace(‘>’, ‘)’)***

![image](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.007.png)

*image*

8.3 Потенциальную уязвимость через Cookie Injection

***<img src=1 onerror=‘javascript:alert(document.cookie)’/>***

Добавляем в cookie:

![](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.008.png)

*image*

Результат при обновлении страницы:

![](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.009.png)

*image*

8.4 Некорректное создание сессионной cookie, которое приводит к захвату сессии (Session hijacking)

![](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.010.png)

*image*

Исправление уязвимостей:

Для уязвимостей Cookie установим флаг http-only, который запрещает любой доступ к куки из JavaScript, а также изменим значение, выводимое браузером в Value с помощью алгоритма хеширования Sha256:

![image](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.011.png)

*image*

![image](Aspose.Words.9caaed46-bbb4-4406-80f1-5db4046c8311.012.png)

*image*
