**Лабораторная работа №2**

Цель работы: Поиск и устранение SQL Injection.

**Задание**

В папке lab2 находится nodejs уязвимое приложение. Необходимо развернуть его, найти SQL инъекцию и исправить. Модифицированное приложение загрузить в свой репозиторий GitHub.
Для выполнения лабораторной потребуется проделать следующие шаги:

1. Установить PostgreSQL сервер любой версии

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.001.png)

2. Создать БД lib

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.002.png)

3. Применить к ней скрипты из папки db (либо создать объекты и вставить данные в таблицы руками). Скрипты выполнять в порядке указанном в имени файла.

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.003.png)

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.004.png)

3.1 Восстановить данные из файла data.sql

При применении скрипта data.sql из-за присутствия кириллицы названия сбились, исправили их через pgAdmin:

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.005.png) ![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.006.png)


4. Установить nodejs версии 14.
4. Перейти в папку lab2 и выполнить в ней команду npm install.

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.007.png)

6. Запустить сайт через Visual Studio Code или через команду npm start.

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.008.png)

7. Войти на сайт и увидеть список книг и авторов

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.009.png)

8. Обнаружить sql инъекцию

Введем конструкцию, которая заведомо вызовет ошибку. Например, символ «b». Получаем следующую ошибку:

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.010.png)

8. Написать отчёт с описанием найденной уязвимости и примерами её эксплуатации

9.1. Обход установленного фильтра 

9.2. Получение данных из другой таблицы 

9.3. Похищение пароля пользователя

Для начала опробуем классическую конструкцию: OR 1=1 -- . Подставим в URL: 3000’ OR 1 = 1 – 

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.011.png)

Далее с помощью UNION - запроса получим названия таблиц и колонок базы данных. Составим запрос такого вида: 

UNION SELECT 0, table\_name, column\_name FROM information\_schema.columns – 

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.012.png)

Теперь получим данные из таблицы book запросом:

` `UNION SELECT id, name, null FROM book -- 

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.013.png)


Чтобы похитить пароль, для начала посмотрим, из чего состоит таблица users аналогичным запросом:

UNION SELECT 0, column\_name, data\_type FROM information\_schema.columns WHERE table\_name = ‘users’ – 

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.014.png)

Видим, что таблица имеет две колонки с текстовыми данными – имя и пароль.

Чтобы найти пароль, используем запрос:

UNION SELECT 0, name, pass FROM public.users – 

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.015.png)

10. Исправить уязвимость. 10.1 В отчёте привести пример того, что уязвимости больше не эксплуатируются

Добавим корректную валидацию для вводимых данных:

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.016.png) 

Теперь при попытке эксплуатации SQL Injection наблюдаем следующую ошибку:

![](Aspose.Words.89a7bdb0-d0e2-4305-a48a-63cdff6a1364.017.png)






